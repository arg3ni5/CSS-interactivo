<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explicaci√≥n Interactiva de CSS</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="manifest" href="site.webmanifest" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Hide stages by default, JavaScript will show them */
        .stage {
            display: none;
        }
        .stage.active {
            display: block;
        }
        /* Custom styles for pseudo-elements example */
        .custom-pseudo-box {
            position: relative;
            /* To make ::before and ::after position relative to this box */
        }
        .custom-pseudo-box::before {
            content: "‚¨ÖÔ∏è "; /* Unicode emoji */
            display: inline-block;
            margin-right: 8px;
            color: #d97706; /* orange-600 */
            font-size: 1.2em;
            font-weight: bold;
        }
        .custom-pseudo-box::after {
            content: " ‚û°Ô∏è"; /* Unicode emoji */
            display: inline-block;
            margin-left: 8px;
            color: #d97706; /* orange-600 */
            font-size: 1.2em;
            font-weight: bold;
        }
        .highlight-border {
            border-color: #3b82f6 !important; /* blue-500 */
            border-width: 4px !important;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5); /* blue-500 with opacity */
        }
        .highlight-text {
            color: #3b82f6 !important; /* blue-500 */
            font-weight: bold;
        }
         /* Loading spinner styles - removed as it's no longer used */
        /*
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        */
    </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 transform transition-all duration-300 ease-in-out scale-95 md:scale-100">
        <h1 class="text-4xl font-extrabold mb-8 text-center text-gray-900 leading-tight">Explorando CSS: Un Viaje Interactivo üöÄ</h1>

        <!-- Stage 1: Box Model -->
        <div id="stage-1" class="stage active">
            <h2 class="text-3xl font-bold mb-6 text-gray-800 text-center">1. El Modelo de Caja (Box Model)</h2>
            <p class="mb-8 text-lg text-gray-700 text-center max-w-2xl mx-auto">
                En CSS, cada elemento HTML es tratado como una caja rectangular. Comprender el Modelo de Caja es absolutamente fundamental para posicionar y dise√±ar tus elementos correctamente.
            </p>

            <div class="relative w-full max-w-xs h-64 mx-auto mb-8 bg-gray-100 rounded-lg flex items-center justify-center shadow-lg overflow-hidden">
                <!-- Interactive box model visualization -->
                <div id="interactive-box" class="flex items-center justify-center text-center text-white transition-all duration-700 ease-in-out font-semibold text-lg bg-blue-500 w-32 h-20">
                    Contenido
                </div>
            </div>

            <div class="mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200 text-center shadow-inner">
                <h3 class="font-bold text-xl mb-3 text-blue-800">Explicaci√≥n Actual:</h3>
                <p id="box-model-explanation" class="text-lg text-blue-700 font-medium"></p>
            </div>
        </div>

        <!-- Stage 2: Propiedades CSS -->
        <div id="stage-2" class="stage">
            <h2 class="text-3xl font-bold mb-6 text-gray-800 text-center">2. Propiedades en CSS</h2>
            <p class="mb-8 text-lg text-gray-700 text-center max-w-2xl mx-auto">
                Las propiedades CSS te permiten estilizar tus elementos de infinitas maneras. Experimenta con algunas de las propiedades m√°s comunes y observa los cambios en tiempo real.
            </p>

            <div class="flex flex-col md:flex-row gap-8">
                <!-- Live preview box -->
                <div class="flex-1 flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-md">
                    <div id="property-box" class="w-48 h-32 bg-purple-500 border-4 border-purple-700 rounded-lg flex items-center justify-center text-white text-lg font-bold shadow-xl transition-all duration-300 transform scale-100">
                        Caja de Ejemplo
                    </div>
                    <div class="mt-6 p-4 bg-gray-800 rounded-lg w-full">
                        <h3 class="font-bold text-xl mb-3 text-green-400">C√≥digo CSS Generado:</h3>
                        <pre class="overflow-x-auto text-sm">
                            <code id="css-code" class="language-css text-green-300">
                                /* Ajusta los valores de abajo para ver el cambio */
                                .property-box {
                                    width: 192px;
                                    height: 128px;
                                    background-color: #8b5cf6; /* purple-500 */
                                    border: 4px solid #6d28d9; /* purple-700 */
                                    border-radius: 8px;
                                    padding: 0px;
                                    margin: 0px;
                                }
                            </code>
                        </pre>
                        <!-- Removed: Gemini API explanation button and output div -->
                        <!--
                        <button id="explain-css-button" class="mt-4 w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300">
                            ‚ú® Explicar este CSS
                            <span id="explain-css-spinner" class="spinner hidden"></span>
                        </button>
                        <div id="css-explanation-output" class="mt-4 p-4 bg-blue-100 text-blue-800 rounded-lg text-left hidden"></div>
                        -->
                    </div>
                </div>

                <!-- Controls for properties -->
                <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-6 bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <div class="control-group">
                        <label for="width-input" class="block text-sm font-semibold text-gray-700 mb-1">Ancho (px):</label>
                        <input type="range" id="width-input" min="50" max="300" value="192" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="width-value" class="text-sm text-gray-500 mt-1 block">192px</span>
                    </div>
                    <div class="control-group">
                        <label for="height-input" class="block text-sm font-semibold text-gray-700 mb-1">Alto (px):</label>
                        <input type="range" id="height-input" min="50" max="300" value="128" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="height-value" class="text-sm text-gray-500 mt-1 block">128px</span>
                    </div>
                    <div class="control-group">
                        <label for="bg-color-input" class="block text-sm font-semibold text-gray-700 mb-1">Color de Fondo:</label>
                        <input type="color" id="bg-color-input" value="#8b5cf6" class="w-full h-10 border border-gray-300 rounded-md cursor-pointer">
                    </div>
                    <div class="control-group">
                        <label for="border-width-input" class="block text-sm font-semibold text-gray-700 mb-1">Borde (px):</label>
                        <input type="range" id="border-width-input" min="0" max="20" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="border-width-value" class="text-sm text-gray-500 mt-1 block">4px</span>
                    </div>
                    <div class="control-group">
                        <label for="border-color-input" class="block text-sm font-semibold text-gray-700 mb-1">Color del Borde:</label>
                        <input type="color" id="border-color-input" value="#6d28d9" class="w-full h-10 border border-gray-300 rounded-md cursor-pointer">
                    </div>
                    <div class="control-group">
                        <label for="border-radius-input" class="block text-sm font-semibold text-gray-700 mb-1">Radio del Borde (px):</label>
                        <input type="range" id="border-radius-input" min="0" max="50" value="8" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="border-radius-value" class="text-sm text-gray-500 mt-1 block">8px</span>
                    </div>
                    <div class="control-group">
                        <label for="padding-input" class="block text-sm font-semibold text-gray-700 mb-1">Padding (px):</label>
                        <input type="range" id="padding-input" min="0" max="50" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="padding-value" class="text-sm text-gray-500 mt-1 block">0px</span>
                    </div>
                    <div class="control-group">
                        <label for="margin-input" class="block text-sm font-semibold text-gray-700 mb-1">Margin (px):</label>
                        <input type="range" id="margin-input" min="0" max="50" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="margin-value" class="text-sm text-gray-500 mt-1 block">0px</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stage 3: Selectores CSS -->
        <div id="stage-3" class="stage">
            <h2 class="text-3xl font-bold mb-6 text-gray-800 text-center">3. Selectores CSS</h2>
            <p class="mb-8 text-lg text-gray-700 text-center max-w-2xl mx-auto">
                Los selectores CSS son "patrones" que coinciden con elementos en el √°rbol HTML para aplicarles estilos. Aprende c√≥mo apuntar a elementos espec√≠ficos para darles vida.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- ID Selector -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">Selector de ID: <code class="text-blue-600 font-mono">#miElementoUnico</code></h3>
                    <p class="text-gray-600 mb-4">Selecciona un elemento HTML √∫nico por su atributo <code>id</code>. Es el m√°s espec√≠fico y solo debe haber uno por p√°gina con el mismo ID.</p>
                    <div id="uniqueElement" class="p-4 bg-red-100 border-2 border-red-300 rounded-lg text-center cursor-pointer hover:bg-red-200 transition-all duration-200 transform hover:scale-105">
                        <p class="text-red-700 font-semibold">Soy el elemento con ID: <code class="font-bold">uniqueElement</code></p>
                    </div>
                    <p class="text-gray-500 text-sm mt-2 text-center">Haz clic para aplicar/quitar estilo.</p>
                    <div id="unique-element-message" class="mt-3 p-2 bg-blue-50 text-blue-800 rounded-md text-sm hidden"></div>
                </div>

                <!-- Tag Selector -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">Selector de Etiqueta: <code class="text-blue-600 font-mono">p</code>, <code class="text-blue-600 font-mono">div</code></h3>
                    <p class="text-gray-600 mb-4">Selecciona todos los elementos de un tipo de etiqueta HTML espec√≠fico (ej., todos los p√°rrafos <code>&lt;p&gt;</code>).</p>
                    <div class="space-y-3">
                        <p class="tag-example p-3 bg-green-100 border border-green-300 rounded text-green-700 cursor-pointer hover:bg-green-200 transition-all duration-200">Este es un p√°rrafo (p).</p>
                        <div class="tag-example p-3 bg-green-100 border border-green-300 rounded text-green-700 cursor-pointer hover:bg-green-200 transition-all duration-200">Este es un div (div).</div>
                        <p class="tag-example p-3 bg-green-100 border border-green-300 rounded text-green-700 cursor-pointer hover:bg-green-200 transition-all duration-200">Otro p√°rrafo (p).</p>
                    </div>
                    <p class="text-gray-500 text-sm mt-2 text-center">Haz clic en cualquier elemento para aplicar/quitar estilo a todos los de su tipo.</p>
                    <div id="tag-example-message" class="mt-3 p-2 bg-blue-50 text-blue-800 rounded-md text-sm hidden"></div>
                </div>

                <!-- Class Selector -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">Selector de Clase: <code class="text-blue-600 font-mono">.miClase</code></h3>
                    <p class="text-gray-600 mb-4">Selecciona todos los elementos que comparten un atributo <code>class</code> espec√≠fico. Permite reutilizar estilos en m√∫ltiples elementos.</p>
                    <div class="space-y-3">
                        <div class="common-class p-3 bg-yellow-100 border border-yellow-300 rounded text-yellow-700 cursor-pointer hover:bg-yellow-200 transition-all duration-200">Elemento con <code class="font-mono">.common-class</code> 1</div>
                        <p class="common-class p-3 bg-yellow-100 border border-yellow-300 rounded text-yellow-700 cursor-pointer hover:bg-yellow-200 transition-all duration-200">Elemento con <code class="font-mono">.common-class</code> 2</p>
                        <span class="common-class inline-block p-3 bg-yellow-100 border border-yellow-300 rounded text-yellow-700 cursor-pointer hover:bg-yellow-200 transition-all duration-200">Elemento con <code class="font-mono">.common-class</code> 3</span>
                    </div>
                    <p class="text-gray-500 text-sm mt-2 text-center">Haz clic en cualquier elemento para aplicar/quitar estilo a todos con la misma clase.</p>
                    <div id="common-class-message" class="mt-3 p-2 bg-blue-50 text-blue-800 rounded-md text-sm hidden"></div>
                </div>

                <!-- Combinator Selector (Descendant) -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 col-span-1 md:col-span-2">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">Selector Combinador: Descendiente (<code class="text-blue-600 font-mono">div p</code>)</h3>
                    <p class="text-gray-600 mb-4">Selecciona todos los elementos <code>&lt;p&gt;</code> que son **descendientes** de un elemento <code>&lt;div&gt;</code> (es decir, dentro de un <code>&lt;div&gt;</code>, directa o indirectamente).</p>
                    <div id="descendant-example" class="p-4 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 text-left cursor-pointer hover:bg-gray-100 transition-all duration-200">
                        <div class="bg-gray-100 p-3 mb-2 rounded border border-gray-200">
                            <p class="descendant-target p-2 bg-blue-50 rounded text-blue-700">Este es un p√°rrafo dentro de un div.</p>
                            <span class="text-gray-600">Este es un span.</span>
                            <div class="mt-2 p-2 bg-gray-200 rounded border border-gray-300">
                                <p class="descendant-target p-2 bg-blue-50 rounded text-blue-700">Otro p√°rrafo, anidado m√°s profundo.</p>
                            </div>
                        </div>
                        <p class="p-2 bg-red-50 rounded text-red-700">Este p√°rrafo NO est√° dentro de un div (es un elemento hermano).</p>
                    </div>
                    <p class="text-gray-500 text-sm mt-2 text-center">Haz clic en la caja gris para aplicar/quitar estilo a los p√°rrafos descendientes.</p>
                    <div id="descendant-message" class="mt-3 p-2 bg-blue-50 text-blue-800 rounded-md text-sm hidden"></div>
                </div>

            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="mt-12 flex justify-center gap-4">
            <button id="prev-button" class="px-6 py-3 bg-gray-300 text-gray-800 font-bold text-lg rounded-full shadow-lg hover:bg-gray-400 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                Concepto Anterior
            </button>
            <button id="next-button" class="px-8 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold text-xl rounded-full shadow-lg hover:from-green-600 hover:to-teal-700 transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-green-300">
                Siguiente Concepto
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stages = document.querySelectorAll('.stage');
            const nextButton = document.getElementById('next-button');
            const prevButton = document.getElementById('prev-button');
            let currentStageIndex = 0; // 0: Box Model, 1: Properties, 2: Selectors

            // Box Model specific elements
            const interactiveBox = document.getElementById('interactive-box');
            const boxModelExplanation = document.getElementById('box-model-explanation');
            let boxModelCurrentStep = 0;

            const boxModelSteps = [
                {
                    css: { width: '80px', height: '60px', padding: '0px', border: '0px solid transparent', margin: '0px', backgroundColor: '#3b82f6', color: 'white', borderRadius: '0px' }, // blue-500
                    explanation: 'El <span class="highlight-text">Contenido</span> es el √°rea donde reside el contenido real del elemento (texto, im√°genes, etc.). Sin padding, sin borde, sin margen.',
                    text: 'Contenido'
                },
                {
                    css: { width: '120px', height: '100px', padding: '20px', border: '0px solid transparent', margin: '0px', backgroundColor: '#22c55e', color: 'white', borderRadius: '0px' }, // green-500
                    explanation: 'El <span class="highlight-text">Padding</span> (relleno) es el espacio entre el contenido y el borde del elemento. Es transparente y hace que la caja sea m√°s grande.',
                    text: 'Contenido + Padding'
                },
                {
                    css: { width: '136px', height: '116px', padding: '20px', border: '8px solid #f97316', margin: '0px', backgroundColor: '#ef4444', color: 'white', borderRadius: '0px' }, // red-500, orange-500 border
                    explanation: 'El <span class="highlight-text">Border</span> (borde) rodea el padding y el contenido. Puedes controlar su ancho, estilo y color. Aumenta el tama√±o total.',
                    text: 'Contenido + Padding + Border'
                },
                {
                    css: { width: '136px', height: '116px', padding: '20px', border: '8px solid #f97316', margin: '20px', backgroundColor: '#8b5cf6', color: 'white', borderRadius: '0px' }, // purple-500, orange-500 border
                    explanation: 'El <span class="highlight-text">Margin</span> (margen) es el espacio exterior al borde. Se utiliza para crear espacio entre elementos y es transparente. No afecta el tama√±o interno de la caja, solo su posici√≥n respecto a otros elementos.',
                    text: 'Contenido + Padding + Border + Margin'
                },
                {
                    explanation: '¬°Has completado la explicaci√≥n del Modelo de Caja! Haz clic en "Siguiente Concepto" para pasar a las Propiedades CSS.',
                    isLastStep: true
                }
            ];

            // CSS Properties specific elements
            const propertyBox = document.getElementById('property-box');
            const cssCodeBlock = document.getElementById('css-code');
            const widthInput = document.getElementById('width-input');
            const heightInput = document.getElementById('height-input');
            const bgColorInput = document.getElementById('bg-color-input');
            const borderWidthInput = document.getElementById('border-width-input');
            const borderColorInput = document.getElementById('border-color-input');
            const borderRadiusInput = document.getElementById('border-radius-input');
            const paddingInput = document.getElementById('padding-input');
            const marginInput = document.getElementById('margin-input');
            // Removed: explainCssButton, explainCssSpinner, cssExplanationOutput variables


            // Selector specific elements
            const uniqueElement = document.getElementById('uniqueElement');
            const tagExamples = document.querySelectorAll('.tag-example');
            const commonClasses = document.querySelectorAll('.common-class');
            const descendantExample = document.getElementById('descendant-example'); // New: reference to the descendant example container
            const descendantTargets = document.querySelectorAll('.descendant-target'); // New: elements to be targeted by descendant selector

            // Message elements for selectors
            const uniqueElementMessage = document.getElementById('unique-element-message');
            const tagExampleMessage = document.getElementById('tag-example-message');
            const commonClassMessage = document.getElementById('common-class-message');
            const descendantMessage = document.getElementById('descendant-message');


            // Function to update the displayed stage
            function updateStageUI() {
                stages.forEach((stage, index) => {
                    if (index === currentStageIndex) {
                        stage.classList.add('active');
                    } else {
                        stage.classList.remove('active');
                    }
                });

                // Update button text and state based on currentStageIndex
                if (currentStageIndex === stages.length - 1) {
                    nextButton.textContent = 'Reiniciar Explicaci√≥n';
                } else if (currentStageIndex === 0 && boxModelCurrentStep < boxModelSteps.length - 1) {
                    nextButton.textContent = 'Siguiente Parte del Modelo de Caja';
                } else {
                    nextButton.textContent = 'Siguiente Concepto';
                }

                // Disable previous button if at the very beginning of the explanation
                if (currentStageIndex === 0 && boxModelCurrentStep === 0) {
                    prevButton.disabled = true;
                } else {
                    prevButton.disabled = false;
                }

                // Initialize/reset specific stage content when stage changes
                if (currentStageIndex === 0) {
                    updateBoxModelVisualization(); // Update visuals and code for current Box Model step
                } else if (currentStageIndex === 1) {
                    updatePropertyBox(); // Apply initial values from inputs
                    // Removed: cssExplanationOutput related lines
                } else if (currentStageIndex === 2) {
                    // Reset selector highlights and messages
                    uniqueElement.classList.remove('highlight-border');
                    tagExamples.forEach(el => el.classList.remove('highlight-border'));
                    commonClasses.forEach(el => el.classList.remove('highlight-border'));
                    descendantTargets.forEach(el => el.classList.remove('highlight-border')); // Reset descendant targets

                    uniqueElementMessage.classList.add('hidden');
                    uniqueElementMessage.textContent = '';
                    tagExampleMessage.classList.add('hidden');
                    tagExampleMessage.textContent = '';
                    commonClassMessage.classList.add('hidden');
                    commonClassMessage.textContent = '';
                    descendantMessage.classList.add('hidden');
                    descendantMessage.textContent = '';
                }
            }

            // Function to update the Box Model visualization (only responsible for box model visuals and text)
            function updateBoxModelVisualization() {
                if (boxModelCurrentStep >= 0 && boxModelCurrentStep < boxModelSteps.length) {
                    const step = boxModelSteps[boxModelCurrentStep];

                    // If it's the last step (the "completed explanation" message)
                    if (step.isLastStep) {
                        boxModelExplanation.innerHTML = step.explanation;
                        // Keep the visual state of the *previous* step
                        const lastVisualStepIndex = boxModelCurrentStep > 0 ? boxModelCurrentStep - 1 : 0;
                        applyBoxModelStyles(boxModelSteps[lastVisualStepIndex].css);
                        interactiveBox.textContent = boxModelSteps[lastVisualStepIndex].text;
                    } else {
                        // Regular visual step
                        applyBoxModelStyles(step.css);
                        boxModelExplanation.innerHTML = step.explanation;
                        interactiveBox.textContent = step.text;
                    }
                }
            }

            function applyBoxModelStyles(styles) {
                // Remove all previous inline styles that might interfere
                interactiveBox.style.cssText = '';

                Object.keys(styles).forEach(prop => {
                    interactiveBox.style[prop] = styles[prop];
                });
            }

            // Helper function to convert camelCase to kebab-case for CSS properties
            function kebabCase(str) {
                return str.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, '$1-$2').toLowerCase();
            }

            // Function to update CSS properties and code block
            function updatePropertyBox() {
                const width = widthInput.value;
                const height = heightInput.value;
                const bgColor = bgColorInput.value;
                const borderWidth = borderWidthInput.value;
                const borderColor = borderColorInput.value;
                const borderRadius = borderRadiusInput.value;
                const padding = paddingInput.value;
                const margin = marginInput.value;

                // Update box styles
                propertyBox.style.width = `${width}px`;
                propertyBox.style.height = `${height}px`;
                propertyBox.style.backgroundColor = bgColor;
                propertyBox.style.border = `${borderWidth}px solid ${borderColor}`;
                propertyBox.style.borderRadius = `${borderRadius}px`;
                propertyBox.style.padding = `${padding}px`;
                propertyBox.style.margin = `${margin}px`;

                // Update range values display
                document.getElementById('width-value').textContent = `${width}px`;
                document.getElementById('height-value').textContent = `${height}px`;
                document.getElementById('border-width-value').textContent = `${borderWidth}px`;
                document.getElementById('border-radius-value').textContent = `${borderRadius}px`;
                document.getElementById('padding-value').textContent = `${padding}px`;
                document.getElementById('margin-value').textContent = `${margin}px`;

                // Update code block
                cssCodeBlock.innerHTML = `
                    .property-box {
                        width: ${width}px;
                        height: ${height}px;
                        background-color: ${bgColor};
                        border: ${borderWidth}px solid ${borderColor};
                        border-radius: ${borderRadius}px;
                        padding: ${padding}px;
                        margin: ${margin}px;
                    }
                `;
                 // Removed: cssExplanationOutput related lines
            }

            // Removed: Gemini API Integration (explainCssButton event listener and associated functions)


            // Event listener for the main "Next" button
            nextButton.addEventListener('click', () => {
                if (currentStageIndex === 0) { // Box Model stage
                    boxModelCurrentStep++;
                    if (boxModelCurrentStep < boxModelSteps.length) { // Still within box model steps
                        updateBoxModelVisualization();
                    } else { // All box model steps are done, transition to next main stage
                        currentStageIndex++;
                        boxModelCurrentStep = 0; // Reset for when we eventually come back to stage 0
                    }
                } else if (currentStageIndex < stages.length - 1) { // Normal progression
                    currentStageIndex++;
                } else { // End of explanation, reset to start
                    currentStageIndex = 0;
                    boxModelCurrentStep = 0; // Reset box model steps
                }
                updateStageUI(); // Always update overall UI after click logic
            });

            // Event listener for the "Previous" button
            prevButton.addEventListener('click', () => {
                if (currentStageIndex === 0) { // Box Model stage
                    boxModelCurrentStep--;
                    if (boxModelCurrentStep < 0) { // Trying to go back from the very first box model step
                        // Loop back to the last *main* stage (Selectors)
                        currentStageIndex = stages.length - 1;
                        // Set boxModelCurrentStep to its last *visual* step
                        boxModelCurrentStep = boxModelSteps.length - 2;
                        if (boxModelCurrentStep < 0) boxModelCurrentStep = 0; // Ensure it doesn't go below 0
                    }
                    updateBoxModelVisualization(); // Always update box model visuals
                } else { // Normal regression
                    currentStageIndex--;
                    // If we are now on the Box Model stage (came from Properties)
                    if (currentStageIndex === 0) {
                         // Set boxModelCurrentStep to the last *visual* step of the box model
                         boxModelCurrentStep = boxModelSteps.length - 2;
                         if (boxModelCurrentStep < 0) boxModelCurrentStep = 0;
                    }
                }
                updateStageUI(); // Always update overall UI after click logic
            });

            // Event listeners for CSS Properties inputs
            const propertyInputs = document.querySelectorAll('#stage-2 input[type="range"], #stage-2 input[type="color"]');
            propertyInputs.forEach(input => {
                input.addEventListener('input', updatePropertyBox);
            });

            // Event listeners for CSS Selectors (click to highlight and show message)
            uniqueElement.addEventListener('click', () => {
                const isActive = uniqueElement.classList.toggle('highlight-border');
                if (isActive) {
                    uniqueElementMessage.textContent = 'Se aplic√≥ la clase ".highlight-border" (borde azul, sombra).';
                    uniqueElementMessage.classList.remove('hidden');
                } else {
                    uniqueElementMessage.textContent = '';
                    uniqueElementMessage.classList.add('hidden');
                }
            });

            tagExamples.forEach(element => {
                element.addEventListener('click', () => {
                    let isActive = false;
                    tagExamples.forEach(el => {
                        const currentIsActive = el.classList.toggle('highlight-border');
                        if (currentIsActive) isActive = true;
                    });

                    if (isActive) {
                        tagExampleMessage.textContent = `Se aplic√≥ la clase ".highlight-border" a todos los <${element.tagName.toLowerCase()}> (borde azul, sombra).`;
                        tagExampleMessage.classList.remove('hidden');
                    } else {
                        tagExampleMessage.textContent = '';
                        tagExampleMessage.classList.add('hidden');
                    }
                });
            });

            commonClasses.forEach(element => {
                element.addEventListener('click', () => {
                    let isActive = false;
                    commonClasses.forEach(el => {
                        const currentIsActive = el.classList.toggle('highlight-border');
                        if (currentIsActive) isActive = true;
                    });

                    if (isActive) {
                        commonClassMessage.textContent = 'Se aplic√≥ la clase ".highlight-border" a todos los elementos con ".common-class" (borde azul, sombra).';
                        commonClassMessage.classList.remove('hidden');
                    } else {
                        commonClassMessage.textContent = '';
                        commonClassMessage.classList.add('hidden');
                    }
                });
            });

            // Event listener for Descendant Selector example
            if (descendantExample) { // Check if element exists
                descendantExample.addEventListener('click', () => {
                    let isActive = false;
                    descendantTargets.forEach(el => {
                        const currentIsActive = el.classList.toggle('highlight-border');
                        if (currentIsActive) isActive = true;
                    });

                    if (isActive) {
                        descendantMessage.textContent = 'Se aplic√≥ la clase ".highlight-border" a los p√°rrafos descendientes de un div (selector "div p").';
                        descendantMessage.classList.remove('hidden');
                    } else {
                        descendantMessage.textContent = '';
                        descendantMessage.classList.add('hidden');
                    }
                });
            }


            // Initial UI update
            updateStageUI();
        });
    </script>
</body>
</html>
